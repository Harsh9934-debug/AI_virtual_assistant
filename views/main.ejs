<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>J.A.R.V.I.S. AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Orbitron", sans-serif;
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
        overflow: hidden;
      }

      /* Animated background grid */
      .grid-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(rgba(0, 234, 255, 0.1) 1px, transparent 1px),
          linear-gradient(90deg, rgba(0, 234, 255, 0.1) 1px, transparent 1px);
        background-size: 50px 50px;
        animation: gridMove 20s linear infinite;
        pointer-events: none;
      }

      @keyframes gridMove {
        0% { transform: translate(0, 0); }
        100% { transform: translate(50px, 50px); }
      }

      /* Glowing orb effect */
      .orb {
        position: absolute;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(0, 234, 255, 0.3) 0%, transparent 70%);
        filter: blur(40px);
        animation: float 6s ease-in-out infinite;
      }

      .orb-1 { top: 10%; left: 20%; animation-delay: 0s; }
      .orb-2 { bottom: 10%; right: 20%; animation-delay: 2s; }
      .orb-3 { top: 50%; left: 50%; animation-delay: 4s; }

      @keyframes float {
        0%, 100% { transform: translate(0, 0) scale(1); }
        50% { transform: translate(30px, -30px) scale(1.1); }
      }

      /* Arc Reactor style circle */
      .arc-reactor {
        width: 200px;
        height: 200px;
        position: relative;
        margin: 0 auto 2rem;
      }

      .arc-circle {
        position: absolute;
        border-radius: 50%;
        border: 2px solid rgba(0, 234, 255, 0.3);
      }

      .arc-circle:nth-child(1) {
        width: 100%;
        height: 100%;
        animation: rotate 8s linear infinite;
      }

      .arc-circle:nth-child(2) {
        width: 80%;
        height: 80%;
        top: 10%;
        left: 10%;
        animation: rotate 6s linear infinite reverse;
      }

      .arc-circle:nth-child(3) {
        width: 60%;
        height: 60%;
        top: 20%;
        left: 20%;
        animation: rotate 4s linear infinite;
      }

      .arc-core {
        position: absolute;
        width: 40%;
        height: 40%;
        top: 30%;
        left: 30%;
        border-radius: 50%;
        background: radial-gradient(circle, #00eaff 0%, rgba(0, 234, 255, 0.2) 50%, transparent 70%);
        box-shadow: 0 0 30px #00eaff, 0 0 60px #00eaff, inset 0 0 20px #00eaff;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
      }

      /* Neon text effects */
      .neon-text {
        text-shadow: 
          0 0 10px #00eaff,
          0 0 20px #00eaff,
          0 0 30px #00eaff,
          0 0 40px #00eaff;
        animation: flicker 3s ease-in-out infinite;
      }

      @keyframes flicker {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
      }

      /* Glass morphism container */
      .glass-container {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 
          0 8px 32px 0 rgba(0, 234, 255, 0.2),
          inset 0 0 20px rgba(0, 234, 255, 0.1);
      }

      /* Button styles */
      .neon-btn {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .neon-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(0, 234, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      .neon-btn:hover::before {
        width: 300px;
        height: 300px;
      }

      .neon-btn:hover {
        box-shadow: 0 0 20px #00eaff, 0 0 40px #00eaff;
        transform: translateY(-2px);
      }

      .neon-btn:active {
        transform: translateY(0);
      }

      .btn-content {
        position: relative;
        z-index: 1;
      }

      /* Status indicator */
      .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }

      .status-active {
        background: #00ff00;
        box-shadow: 0 0 10px #00ff00;
        animation: blink 1s infinite;
      }

      .status-inactive {
        background: #666;
      }

      @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      /* Command history */
      .command-item {
        background: rgba(0, 234, 255, 0.1);
        border-left: 3px solid #00eaff;
        padding: 0.5rem 1rem;
        margin: 0.5rem 0;
        border-radius: 0 8px 8px 0;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* Wave animation for listening */
      .wave-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 4px;
        height: 40px;
      }

      .wave-bar {
        width: 4px;
        height: 10px;
        background: #00eaff;
        border-radius: 2px;
        animation: wave 1s ease-in-out infinite;
      }

      .wave-bar:nth-child(1) { animation-delay: 0s; }
      .wave-bar:nth-child(2) { animation-delay: 0.1s; }
      .wave-bar:nth-child(3) { animation-delay: 0.2s; }
      .wave-bar:nth-child(4) { animation-delay: 0.3s; }
      .wave-bar:nth-child(5) { animation-delay: 0.4s; }

      @keyframes wave {
        0%, 100% { height: 10px; }
        50% { height: 30px; }
      }

      /* Scrollbar */
      .command-history::-webkit-scrollbar {
        width: 8px;
      }

      .command-history::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
      }

      .command-history::-webkit-scrollbar-thumb {
        background: rgba(0, 234, 255, 0.5);
        border-radius: 4px;
      }

      .command-history::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 234, 255, 0.8);
      }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <!-- Animated background -->
    <div class="grid-background"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <!-- Main container -->
    <div class="relative z-10 max-w-4xl w-full">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Left Panel - Main Interface -->
        <div class="glass-container p-8 rounded-3xl">
          <!-- Arc Reactor Animation -->
          <div class="arc-reactor">
            <div class="arc-circle"></div>
            <div class="arc-circle"></div>
            <div class="arc-circle"></div>
            <div class="arc-core"></div>
          </div>

          <!-- Title -->
          <h1 class="text-4xl text-center text-white font-black neon-text mb-2">
            J.A.R.V.I.S
          </h1>
          <p class="text-center text-cyan-400 text-sm mb-6">
            Just A Rather Very Intelligent System
          </p>

          <!-- Status -->
          <div class="text-center mb-6">
            <span class="status-dot" id="statusDot"></span>
            <span class="text-white text-sm" id="statusText">Ready</span>
          </div>

          <!-- Wave Animation (hidden by default) -->
          <div class="wave-container mb-6 hidden" id="waveAnimation">
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
            <div class="wave-bar"></div>
          </div>

          <!-- Control Buttons -->
          <div class="space-y-4">
            <button
              id="startRecognition"
              class="neon-btn w-full bg-transparent border-2 border-cyan-400 text-cyan-400 font-bold py-4 px-6 rounded-xl transition duration-300 hover:bg-cyan-400 hover:text-black"
            >
              <span class="btn-content flex items-center justify-center gap-3">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                </svg>
                <span>Activate Voice Command</span>
              </span>
            </button>

            <button
              id="stopButton"
              class="w-full bg-red-500/20 border-2 border-red-500 text-red-400 font-bold py-4 px-6 rounded-xl transition duration-300 hover:bg-red-500 hover:text-white"
            >
              <span class="flex items-center justify-center gap-3">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                </svg>
                <span>Deactivate</span>
              </span>
            </button>
          </div>

          <!-- System Info -->
          <div class="mt-6 pt-6 border-t border-cyan-400/20">
            <div class="grid grid-cols-2 gap-4 text-xs text-gray-400">
              <div>
                <p class="text-cyan-400 font-semibold">Version</p>
                <p>2.0.1</p>
              </div>
              <div>
                <p class="text-cyan-400 font-semibold">Status</p>
                <p class="text-green-400">Online</p>
              </div>
            </div>
          </div>

          <!-- Chrome-only notice -->
          <div
            id="chromeOnlyNotice"
            class="fixed z-50 top-4 left-4 right-4 md:right-auto md:w-[420px]
                   rounded-xl border border-yellow-400/40 bg-yellow-400/10
                   px-4 py-3 backdrop-blur-md"
          >
            <p class="text-yellow-200 text-xs leading-relaxed">
              Voice commands work best in <span class="font-semibold">Google Chrome</span>.
              If microphone/voice recognition doesnâ€™t start, please open this page in Chrome and allow microphone access.
            </p>
          </div>
        </div>

        <!-- Right Panel - Command History -->
        <div class="glass-container p-8 rounded-3xl flex flex-col">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl text-white font-bold flex items-center gap-2">
              <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              Command History
            </h2>
            <button id="clearHistory" class="text-xs text-red-400 hover:text-red-300 transition">
              Clear
            </button>
          </div>

          <div class="command-history flex-1 overflow-y-auto max-h-96 space-y-2" id="commandHistory">
            <p class="text-gray-500 text-sm text-center py-8">No commands yet. Start by activating voice command.</p>
          </div>

          <!-- Quick Commands -->
          <div class="mt-6 pt-6 border-t border-cyan-400/20">
            <p class="text-xs text-gray-400 mb-3">Quick Commands:</p>
            <div class="flex flex-wrap gap-2">
              <button class="quick-cmd text-xs bg-cyan-400/10 text-cyan-400 px-3 py-1 rounded-full border border-cyan-400/30 hover:bg-cyan-400/20 transition">
                What time is it?
              </button>
              <button class="quick-cmd text-xs bg-cyan-400/10 text-cyan-400 px-3 py-1 rounded-full border border-cyan-400/30 hover:bg-cyan-400/20 transition">
                Take note: Meeting at 3
              </button>
              <button class="quick-cmd text-xs bg-cyan-400/10 text-cyan-400 px-3 py-1 rounded-full border border-cyan-400/30 hover:bg-cyan-400/20 transition">
                Add task: Call John
              </button>
              <button class="quick-cmd text-xs bg-cyan-400/10 text-cyan-400 px-3 py-1 rounded-full border border-cyan-400/30 hover:bg-cyan-400/20 transition">
                Morning routine
              </button>
              <button class="quick-cmd text-xs bg-cyan-400/10 text-cyan-400 px-3 py-1 rounded-full border border-cyan-400/30 hover:bg-cyan-400/20 transition">
                Water reminder every hour
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <script>
      const start = document.getElementById("startRecognition");
      const stopButton = document.getElementById("stopButton");
      const statusDot = document.getElementById("statusDot");
      const statusText = document.getElementById("statusText");
      const waveAnimation = document.getElementById("waveAnimation");
      const commandHistory = document.getElementById("commandHistory");
      const clearHistory = document.getElementById("clearHistory");

      let isSpeaking = false;
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      const synth = window.speechSynthesis;

      // Update status
      function updateStatus(status, text) {
        statusDot.className = `status-dot ${status}`;
        statusText.textContent = text;
      }

      // Add command to history
      function addToHistory(command, response) {
        const isEmpty = commandHistory.querySelector('p.text-gray-500');
        if (isEmpty) isEmpty.remove();

        const item = document.createElement('div');
        item.className = 'command-item';
        item.innerHTML = `
          <div class="flex items-start gap-2">
            <svg class="w-4 h-4 text-cyan-400 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
            <div class="flex-1">
              <p class="text-white text-sm font-semibold">${command}</p>
              <p class="text-gray-400 text-xs mt-1">${response}</p>
              <p class="text-gray-600 text-xs mt-1">${new Date().toLocaleTimeString()}</p>
            </div>
          </div>
        `;
        commandHistory.insertBefore(item, commandHistory.firstChild);
        
        // Keep only last 10 items
        if (commandHistory.children.length > 10) {
          commandHistory.removeChild(commandHistory.lastChild);
        }
      }

      start.addEventListener("click", () => {
        if (isSpeaking) return;
        console.log("Listening for Command...");
        synth.cancel();
        recognition.start();
        updateStatus('status-active', 'Listening...');
        waveAnimation.classList.remove('hidden');
        start.disabled = true;
      });

      recognition.onresult = async ({ results }) => {
        recognition.stop();
        waveAnimation.classList.add('hidden');
        const recognizedText = results[0][0].transcript;
        console.log("Recognized Text:", recognizedText);

        if (!recognizedText.trim() || isSpeaking) return;

        try {
            isSpeaking = true;
            updateStatus('status-active', 'Processing...');
            start.innerHTML = '<span class="btn-content">Processing...</span>';

            const response = await fetch("http://localhost:3000/jarvis/virtualAssistant", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: recognizedText }),
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            
            const data = await response.json();
            console.log("Response from server:", data.response);

            addToHistory(recognizedText, data.response);
            updateStatus('status-active', 'Speaking...');

            synth.cancel();
            
            const utterance = new SpeechSynthesisUtterance(data.response);
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            utterance.onend = () => {
                isSpeaking = false;
                start.disabled = false;
                start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
                updateStatus('status-inactive', 'Ready');
            };

            utterance.onerror = (event) => {
                console.error("Speech error:", event);
                isSpeaking = false;
                start.disabled = false;
                start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
                updateStatus('status-inactive', 'Ready');
            };

            synth.speak(utterance);
        } catch (error) {
            console.error("Error:", error);
            isSpeaking = false;
            start.disabled = false;
            start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
            updateStatus('status-inactive', 'Error');
        }
      };

      recognition.onerror = (event) => {
        console.log("Recognition error:", event.error);
        waveAnimation.classList.add('hidden');
        isSpeaking = false;
        start.disabled = false;
        start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
        updateStatus('status-inactive', 'Ready');
      };

      stopButton.addEventListener("click", () => {
        synth.cancel();
        recognition.stop();
        waveAnimation.classList.add('hidden');
        isSpeaking = false;
        start.disabled = false;
        start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
        updateStatus('status-inactive', 'Ready');
      });

      clearHistory.addEventListener("click", () => {
        commandHistory.innerHTML = '<p class="text-gray-500 text-sm text-center py-8">No commands yet. Start by activating voice command.</p>';
      });

      // Quick command buttons
      document.querySelectorAll('.quick-cmd').forEach(btn => {
        btn.addEventListener('click', async () => {
          const command = btn.textContent.trim();
          if (isSpeaking) return;

          try {
            isSpeaking = true;
            updateStatus('status-active', 'Processing...');
            start.disabled = true;

            const response = await fetch("http://localhost:3000/jarvis/virtualAssistant", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: command }),
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            
            const data = await response.json();
            addToHistory(command, data.response);

            const utterance = new SpeechSynthesisUtterance(data.response);
            utterance.onend = () => {
                isSpeaking = false;
                start.disabled = false;
                updateStatus('status-inactive', 'Ready');
            };
            synth.speak(utterance);
          } catch (error) {
            console.error("Error:", error);
            isSpeaking = false;
            start.disabled = false;
            updateStatus('status-inactive', 'Error');
          }
        });
      });

      // Only hide on *real* Google Chrome (not Edge/Opera/Brave)
      (function chromeOnlyBanner() {
        const el = document.getElementById("chromeOnlyNotice");
        if (!el) return;

        const ua = navigator.userAgent || "";
        const vendor = navigator.vendor || "";

        const isChromium = /Chrome\//.test(ua);
        const isEdge = /Edg\//.test(ua);
        const isOpera = /OPR\//.test(ua);
        const isBrave = typeof navigator.brave !== "undefined" || /Brave\//.test(ua);

        // Google Chrome usually reports vendor "Google Inc."
        const isGoogleChrome = isChromium && vendor === "Google Inc." && !isEdge && !isOpera && !isBrave;

        if (isGoogleChrome) el.style.display = "none";
      })();

      // Initialize status
      updateStatus('status-inactive', 'Ready');
    </script>
</body>
</html>