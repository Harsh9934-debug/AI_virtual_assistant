<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atlas - AI Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap");

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Orbitron", sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(16, 185, 129, 0.18), transparent 55%),
        radial-gradient(900px 500px at 90% 80%, rgba(20, 184, 166, 0.18), transparent 55%),
        linear-gradient(135deg, #070a0f 0%, #0b1220 55%, #070a0f 100%);
      overflow: hidden;
    }

    /* Subtle vignette for more depth */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at 50% 30%, transparent 0%, rgba(0,0,0,0.55) 70%, rgba(0,0,0,0.8) 100%);
    }

    /* Slightly stronger glass + hover lift */
    .glass-container {
      background: rgba(255, 255, 255, 0.055);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow:
        0 18px 50px 0 rgba(16, 185, 129, 0.14),
        inset 0 0 22px rgba(20, 184, 166, 0.10);
      transition: transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
    }

    .glass-container:hover {
      transform: translateY(-2px);
      border-color: rgba(16, 185, 129, 0.22);
      box-shadow:
        0 22px 70px 0 rgba(16, 185, 129, 0.18),
        inset 0 0 26px rgba(20, 184, 166, 0.12);
    }

    /* Animated background grid */
    .grid-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(rgba(20, 184, 166, 0.12) 1px, transparent 1px),
        linear-gradient(90deg, rgba(20, 184, 166, 0.12) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
      pointer-events: none;
    }

    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    /* Glowing orb effect */
    .orb {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(16, 185, 129, 0.25) 0%, transparent 70%);
      filter: blur(40px);
      animation: float 6s ease-in-out infinite;
    }

    .orb-1 { top: 10%; left: 20%; animation-delay: 0s; }
    .orb-2 { bottom: 10%; right: 20%; animation-delay: 2s; }
    .orb-3 { top: 50%; left: 50%; animation-delay: 4s; }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(30px, -30px) scale(1.1); }
    }

    /* Arc Reactor style circle */
    .arc-reactor {
      width: 200px;
      height: 200px;
      position: relative;
      margin: 0 auto 2rem;
    }

    .arc-circle {
      position: absolute;
      border-radius: 50%;
      border: 2px solid rgba(16, 185, 129, 0.28);
    }

    .arc-circle:nth-child(1) {
      width: 100%;
      height: 100%;
      animation: rotate 8s linear infinite;
    }

    .arc-circle:nth-child(2) {
      width: 80%;
      height: 80%;
      top: 10%;
      left: 10%;
      animation: rotate 6s linear infinite reverse;
    }

    .arc-circle:nth-child(3) {
      width: 60%;
      height: 60%;
      top: 20%;
      left: 20%;
      animation: rotate 4s linear infinite;
    }

    .arc-core {
      position: absolute;
      width: 40%;
      height: 40%;
      top: 30%;
      left: 30%;
      border-radius: 50%;
      background: radial-gradient(circle, #10b981 0%, rgba(20, 184, 166, 0.22) 50%, transparent 70%);
      box-shadow: 0 0 30px #10b981, 0 0 60px rgba(20, 184, 166, 0.8), inset 0 0 20px #10b981;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }

    /* Cleaner, tighter neon text */
    .neon-text {
      text-shadow:
        0 0 8px rgba(16, 185, 129, 0.75),
        0 0 18px rgba(20, 184, 166, 0.55),
        0 0 34px rgba(16, 185, 129, 0.35);
      animation: flicker 3s ease-in-out infinite;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    /* Status indicator tweaks */
    .status-active {
      background: #10b981;
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.9), 0 0 22px rgba(20, 184, 166, 0.65);
      animation: blink 1s infinite;
    }

    .status-inactive {
      background: rgba(148,163,184,0.55); /* slate */
    }

    /* Buttons: nicer glow */
    .neon-btn:hover {
      box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.25),
                  0 0 22px rgba(16, 185, 129, 0.55),
                  0 0 46px rgba(20, 184, 166, 0.35);
      transform: translateY(-2px);
    }

    /* Command history */
    .command-item {
      background: rgba(16, 185, 129, 0.12);
      border-left: 3px solid #10b981;
      padding: 0.5rem 1rem;
      margin: 0.5rem 0;
      border-radius: 0 8px 8px 0;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Wave animation for listening */
    .wave-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 4px;
      height: 40px;
    }

    .wave-bar {
      width: 4px;
      height: 10px;
      background: #10b981;
      border-radius: 2px;
      animation: wave 1s ease-in-out infinite;
    }

    .wave-bar:nth-child(1) { animation-delay: 0s; }
    .wave-bar:nth-child(2) { animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { animation-delay: 0.4s; }

    @keyframes wave {
      0%, 100% { height: 10px; }
      50% { height: 30px; }
    }

    /* Scrollbar */
    .command-history::-webkit-scrollbar {
      width: 8px;
    }

    .command-history::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }

    .command-history::-webkit-scrollbar-thumb {
      background: rgba(16, 185, 129, 0.55);
      border-radius: 4px;
    }
    .command-history::-webkit-scrollbar-thumb:hover {
      background: rgba(16, 185, 129, 0.85);
    }

    /* Extra polish helpers */
    .hud-card{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 18px 60px rgba(16,185,129,0.12);
      backdrop-filter: blur(10px);
    }
    .status-pill{
      border: 1px solid rgba(16,185,129,0.25);
      box-shadow: 0 0 0 1px rgba(16,185,129,0.08), 0 0 22px rgba(16,185,129,0.18);
    }
    .console{
      background: rgba(3, 7, 14, 0.35);
      border: 1px solid rgba(16,185,129,0.18);
    }
    .console pre{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Make the vignette sit behind UI (your body::after already exists) */
    body::after { z-index: 0; }

    /* Subtle scanlines */
    .scanlines::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.04) 0px,
        rgba(255,255,255,0.04) 1px,
        transparent 2px,
        transparent 6px
      );
      mix-blend-mode: overlay;
      opacity: .12;
      z-index: 1;
    }

    /* Softer global type */
    .muted { color: rgba(226,232,240,0.72); }

    /* Better buttons */
    button:disabled{
      opacity: .55;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    .neon-btn:active{
      transform: translateY(0px) scale(0.99);
      filter: saturate(1.15);
    }

    /* Reactor listening ring */
    .reactor-wrap{
      position: relative;
      width: 170px;
      height: 170px;
      margin: 0 auto 1.25rem;
    }
    .listening-ring{
      position:absolute;
      inset:-10px;
      border-radius:9999px;
      border:1px solid rgba(16,185,129,0.22);
      box-shadow: 0 0 0 1px rgba(16,185,129,0.08), 0 0 22px rgba(16,185,129,0.18);
      opacity: 0;
      transition: opacity 180ms ease;
    }
    .listening-ring.is-on{
      opacity: 1;
      animation: ringPulse 1.1s ease-in-out infinite;
    }
    @keyframes ringPulse{
      0%{ box-shadow:0 0 0 1px rgba(16,185,129,0.10), 0 0 14px rgba(16,185,129,0.14); }
      50%{ box-shadow:0 0 0 1px rgba(16,185,129,0.18), 0 0 26px rgba(16,185,129,0.22); }
      100%{ box-shadow:0 0 0 1px rgba(16,185,129,0.10), 0 0 14px rgba(16,185,129,0.14); }
    }

    /* Console log cards */
    .log-card{
      background: rgba(2, 6, 12, 0.35);
      border: 1px solid rgba(16,185,129,0.16);
      border-left: 3px solid rgba(16,185,129,0.9);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 9999px;
      border: 1px solid rgba(16,185,129,0.22);
      color: rgba(167,243,208,0.95);
      background: rgba(16,185,129,0.10);
    }
    .badge .dot{
      width:6px;height:6px;border-radius:9999px;background:#10b981;
      box-shadow:0 0 10px rgba(16,185,129,0.8);
    }
    .log-time{
      font-size: 10px;
      color: rgba(148,163,184,0.75);
      margin-top: 6px;
    }
  </style>
</head>

<body class="min-h-screen bg-black scanlines">
  <!-- Animated background -->
  <div class="grid-background"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>

  <!-- Outer wrapper (more breathing room) -->
  <div class="relative z-10 mx-auto w-full max-w-6xl px-4 py-8">
    <!-- Top HUD -->
    <div class="hud-card rounded-2xl px-5 py-4 mb-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-emerald-400/15 border border-emerald-400/25 flex items-center justify-center">
          <span class="text-emerald-300 font-black tracking-widest">A</span>
        </div>
        <div>
          <div class="text-white font-black tracking-wider">Atlas</div>
          <div class="text-xs text-slate-300/80">Adaptive Tactical Learning Utility System</div>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <div class="status-pill rounded-full px-3 py-1.5 flex items-center gap-2">
          <span class="inline-block h-2.5 w-2.5 rounded-full bg-emerald-400 shadow-[0_0_12px_rgba(16,185,129,0.9)]"></span>
          <span class="text-xs text-emerald-200">Online</span>
        </div>
        <div class="text-xs text-slate-300/80">v2.0.1</div>
      </div>
    </div>

    <!-- Main grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Left Panel -->
      <div class="glass-container rounded-3xl p-7 lg:p-8">
        <!-- Reactor -->
        <div class="reactor-wrap">
          <div id="listeningRing" class="listening-ring"></div>
          <div class="arc-reactor" style="width:170px;height:170px;margin:0;">
            <div class="arc-circle"></div>
            <div class="arc-circle"></div>
            <div class="arc-circle"></div>
            <div class="arc-core"></div>
          </div>
        </div>

        <div class="text-center">
          <h1 class="text-4xl text-white font-black neon-text">Atlas</h1>
          <p class="text-emerald-300 text-sm mt-2 muted">Voice-enabled command assistant</p>
        </div>

        <!-- Status -->
        <div class="mt-6 flex items-center justify-center">
          <div class="console rounded-xl px-4 py-3 flex items-center gap-3">
            <span class="status-dot" id="statusDot"></span>
            <span class="text-white text-sm" id="statusText">Ready</span>
          </div>
        </div>

        <!-- Wave -->
        <div class="wave-container mt-5 hidden" id="waveAnimation">
          <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
        </div>

        <!-- Controls -->
        <div class="mt-6 space-y-3">
          <button
            id="startRecognition"
            class="neon-btn w-full bg-emerald-400/10 border border-emerald-400/40 text-emerald-200 font-bold py-4 px-6 rounded-2xl transition duration-300 hover:bg-emerald-400 hover:text-black"
          >
            <span class="btn-content flex items-center justify-center gap-3">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
              </svg>
              <span>Start Listening</span>
            </span>
          </button>

          <button
            id="stopButton"
            class="w-full bg-rose-500/15 border border-rose-500/40 text-rose-200 font-bold py-4 px-6 rounded-2xl transition duration-300 hover:bg-rose-500 hover:text-white"
          >
            <span class="flex items-center justify-center gap-3">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
              </svg>
              <span>Stop</span>
            </span>
          </button>
        </div>

        <!-- Tips -->
        <div class="mt-6 console rounded-2xl p-4">
          <p class="text-xs text-slate-200/80 leading-relaxed">
            Try: <span class="text-emerald-200">"set timer for 10 seconds"</span>, <span class="text-emerald-200">"take note: buy groceries"</span>,
            <span class="text-emerald-200">"system status"</span>.
          </p>
        </div>

        <!-- Chrome-only notice (keep) -->
        <div
          id="chromeOnlyNotice"
          class="fixed z-50 top-4 left-4 right-4 md:right-auto md:w-[420px]
                 rounded-xl border border-yellow-400/40 bg-yellow-400/10
                 px-4 py-3 backdrop-blur-md"
        >
          <p class="text-yellow-200 text-xs leading-relaxed">
            Voice commands work best in <span class="font-semibold">Google Chrome</span>.
            If microphone/voice recognition doesn’t start, please open this page in Chrome and allow microphone access.
          </p>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="glass-container rounded-3xl p-7 lg:p-8 flex flex-col">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h2 class="text-xl text-white font-bold">Atlas Console</h2>
            <p class="text-xs text-slate-300/80 mt-1">Commands / responses (latest first)</p>
          </div>
          <button id="clearHistory" class="text-xs text-rose-300 hover:text-rose-200 transition">
            Clear
          </button>
        </div>

        <div class="mt-4 console rounded-2xl p-3 flex-1 overflow-y-auto max-h-[28rem] space-y-2 command-history" id="commandHistory">
          <!-- keep empty state, but prettier -->
          <div class="text-center py-10">
            <div class="text-slate-200/90 font-semibold">No commands yet</div>
            <div class="text-slate-400 text-sm mt-2">Press <span class="text-emerald-200 font-semibold">Start Listening</span> and speak a command.</div>
            <div class="text-[11px] text-slate-400/70 mt-3">Tip: try “set timer for 10 seconds”.</div>
          </div>
        </div>

        <div class="mt-5 pt-5 border-t border-emerald-400/20">
          <p class="text-xs text-slate-300/80 mb-3">Quick Commands</p>
          <div class="flex flex-wrap gap-2">
            <button class="quick-cmd text-xs bg-emerald-400/10 text-emerald-200 px-3 py-2 rounded-full border border-emerald-400/25 hover:bg-emerald-400/20 transition">
              What time is it?
            </button>
            <button class="quick-cmd text-xs bg-emerald-400/10 text-emerald-200 px-3 py-2 rounded-full border border-emerald-400/25 hover:bg-emerald-400/20 transition">
              Take note: Meeting at 3
            </button>
            <button class="quick-cmd text-xs bg-emerald-400/10 text-emerald-200 px-3 py-2 rounded-full border border-emerald-400/25 hover:bg-emerald-400/20 transition">
              Add task: Call John
            </button>
            <button class="quick-cmd text-xs bg-emerald-400/10 text-emerald-200 px-3 py-2 rounded-full border border-emerald-400/25 hover:bg-emerald-400/20 transition">
              System status
            </button>
            <button class="quick-cmd text-xs bg-emerald-400/10 text-emerald-200 px-3 py-2 rounded-full border border-emerald-400/25 hover:bg-emerald-400/20 transition">
              Set timer for 10 seconds
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const start = document.getElementById("startRecognition");
    const stopButton = document.getElementById("stopButton");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const waveAnimation = document.getElementById("waveAnimation");
    const commandHistory = document.getElementById("commandHistory");
    const clearHistory = document.getElementById("clearHistory");

    let isSpeaking = false;
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    const synth = window.speechSynthesis;

    // --- Female voice selection ---
    let preferredVoice = null;

    function pickFemaleVoice() {
      const voices = synth.getVoices ? synth.getVoices() : [];
      if (!voices.length) return;

      const isFemaleName = (name = "") =>
        /(female|woman|girl|zira|susan|samantha|victoria|tessa|karen|moira|fiona|amy|emma|olivia|ava|aria|joanna|kendra|kimberly)/i.test(name);

      // Prefer: English + female-ish name
      preferredVoice =
        voices.find(v => (v.lang || "").toLowerCase().startsWith("en") && isFemaleName(v.name)) ||
        voices.find(v => isFemaleName(v.name)) ||
        voices.find(v => (v.lang || "").toLowerCase().startsWith("en")) ||
        voices[0] ||
        null;
    }

    // Some browsers load voices async
    pickFemaleVoice();
    if (typeof synth.onvoiceschanged !== "undefined") {
      synth.onvoiceschanged = () => pickFemaleVoice();
    }

    function applyVoice(utterance) {
      if (preferredVoice) utterance.voice = preferredVoice;
      utterance.lang = preferredVoice?.lang || utterance.lang || "en-US";
      return utterance;
    }

    // Update status
    function updateStatus(status, text) {
      statusDot.className = `status-dot ${status}`;
      statusText.textContent = text;
    }

    // Add command to history
    function addToHistory(command, response) {
      // remove empty state if present
      const emptyBlock = commandHistory.querySelector('div.text-center');
      if (emptyBlock) emptyBlock.remove();

      const item = document.createElement('div');
      item.className = 'log-card';

      item.innerHTML = `
        <div class="flex items-center justify-between gap-3">
          <span class="badge"><span class="dot"></span> ATLAS</span>
          <span class="log-time">${new Date().toLocaleTimeString()}</span>
        </div>
        <pre class="text-slate-100 text-sm mt-2"><span class="text-emerald-200 font-semibold">&gt;</span> ${command}</pre>
        <pre class="text-slate-300 text-xs mt-2">${response}</pre>
      `;

      commandHistory.insertBefore(item, commandHistory.firstChild);

      // Keep only last 10 items
      while (commandHistory.children.length > 10) {
        commandHistory.removeChild(commandHistory.lastChild);
      }
    }

    // Speak helper (reused for local shortcuts)
    function speakText(text) {
      synth.cancel();
      const u = applyVoice(new SpeechSynthesisUtterance(text));
      u.rate = 1.0;
      u.pitch = 1.15; // slightly more natural for many female voices
      u.volume = 1.0;

      u.onend = () => {
        isSpeaking = false;
        start.disabled = false;
        // keep your existing UI label behavior
        start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
        updateStatus('status-inactive', 'Ready');
      };

      u.onerror = () => {
        isSpeaking = false;
        start.disabled = false;
        start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
        updateStatus('status-inactive', 'Ready');
      };

      synth.speak(u);
    }

    start.addEventListener("click", () => {
      if (isSpeaking) return;
      console.log("Listening for Command...");
      synth.cancel();
      recognition.start();
      updateStatus('status-active', 'Listening...');
      waveAnimation.classList.remove('hidden');
      start.disabled = true;
      if (listeningRing) listeningRing.classList.add("is-on");
    });

    recognition.onresult = async ({ results }) => {
      recognition.stop();
      waveAnimation.classList.add('hidden');
      const recognizedText = results[0][0].transcript;
      console.log("Recognized Text:", recognizedText);

      if (!recognizedText.trim() || isSpeaking) return;

      // --- Improved Local shortcuts (no backend call) ---
      // normalize: lowercase, remove punctuation, collapse spaces
      const qRaw = recognizedText.toLowerCase();
      const q = qRaw.replace(/[^\w\s]/g, " ").replace(/\s+/g, " ").trim();

      // match more variants:
      // - "what is your name"
      // - "what's your name"
      // - "what your name is"
      // - "tell me your name"
      const isNameQuestion =
        /\b(what|whats|what s)\b.*\b(your)\b.*\bname\b/.test(q) ||
        /\bwhat\b.*\bname\b.*\bis\b/.test(q) ||
        /\btell\b.*\b(your)\b.*\bname\b/.test(q) ||
        q === "your name";

      // - "who created you"
      // - "who made you"
      // - "who is your creator"
      const isCreatorQuestion =
        /\bwho\b.*\b(created|made)\b.*\byou\b/.test(q) ||
        /\bwho\b.*\b(your)\b.*\bcreator\b/.test(q);

      if (isNameQuestion || isCreatorQuestion) {
        isSpeaking = true;
        start.disabled = true;
        updateStatus('status-active', 'Speaking...');

        const localResponse = isNameQuestion
          ? "Atlas"
          : "I am created by Harsh kumar gupta";

        addToHistory(recognizedText, localResponse);
        speakText(localResponse);
        return;
      }

      try {
          isSpeaking = true;
          updateStatus('status-active', 'Processing...');
          start.innerHTML = '<span class="btn-content">Processing...</span>';

          const response = await fetch("http://localhost:3000/jarvis/virtualAssistant", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ prompt: recognizedText }),
          });

          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          
          const data = await response.json();
          console.log("Response from server:", data.response);

          addToHistory(recognizedText, data.response);
          updateStatus('status-active', 'Speaking...');

          synth.cancel();
          
          const utterance = applyVoice(new SpeechSynthesisUtterance(data.response));
          utterance.rate = 1.0;
          utterance.pitch = 1.15;
          utterance.volume = 1.0;

          utterance.onend = () => {
              isSpeaking = false;
              start.disabled = false;
              start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
              updateStatus('status-inactive', 'Ready');
          };

          utterance.onerror = (event) => {
              console.error("Speech error:", event);
              isSpeaking = false;
              start.disabled = false;
              start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
              updateStatus('status-inactive', 'Ready');
          };

          synth.speak(utterance);
      } catch (error) {
          console.error("Error:", error);
          isSpeaking = false;
          start.disabled = false;
          start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
          updateStatus('status-inactive', 'Error');
      }
    };

    recognition.onerror = (event) => {
      console.log("Recognition error:", event.error);
      waveAnimation.classList.add('hidden');
      isSpeaking = false;
      start.disabled = false;
      start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
      updateStatus('status-inactive', 'Ready');
    };

    stopButton.addEventListener("click", () => {
      synth.cancel();
      recognition.stop();
      waveAnimation.classList.add('hidden');
      isSpeaking = false;
      start.disabled = false;
      start.innerHTML = '<span class="btn-content flex items-center justify-center gap-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg><span>Activate Voice Command</span></span>';
      updateStatus('status-inactive', 'Ready');
      if (listeningRing) listeningRing.classList.remove("is-on");
    });

    clearHistory.addEventListener("click", () => {
      commandHistory.innerHTML = '<div class="text-center py-10"><div class="text-slate-200/90 font-semibold">No commands yet</div><div class="text-slate-400 text-sm mt-2">Press <span class="text-emerald-200 font-semibold">Start Listening</span> and speak a command.</div></div>';
    });

    // Quick command buttons
    document.querySelectorAll('.quick-cmd').forEach(btn => {
      btn.addEventListener('click', async () => {
        const command = btn.textContent.trim();
        if (isSpeaking) return;

        try {
          isSpeaking = true;
          updateStatus('status-active', 'Processing...');
          start.disabled = true;

          const response = await fetch("http://localhost:3000/jarvis/virtualAssistant", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ prompt: command }),
          });

          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          
          const data = await response.json();
          addToHistory(command, data.response);

          const utterance = applyVoice(new SpeechSynthesisUtterance(data.response));
          utterance.rate = 1.0;
          utterance.pitch = 1.15;
          utterance.volume = 1.0;

          utterance.onend = () => {
            isSpeaking = false;
            start.disabled = false;
            updateStatus('status-inactive', 'Ready');
          };

          synth.speak(utterance);
        } catch (error) {
          console.error("Error:", error);
          isSpeaking = false;
          start.disabled = false;
          updateStatus('status-inactive', 'Error');
        }
      });
    });

    // Only hide on *real* Google Chrome (not Edge/Opera/Brave)
    (function chromeOnlyBanner() {
      const el = document.getElementById("chromeOnlyNotice");
      if (!el) return;

      const ua = navigator.userAgent || "";
      const vendor = navigator.vendor || "";

      const isChromium = /Chrome\//.test(ua);
      const isEdge = /Edg\//.test(ua);
      const isOpera = /OPR\//.test(ua);
      const isBrave = typeof navigator.brave !== "undefined" || /Brave\//.test(ua);

      // Google Chrome usually reports vendor "Google Inc."
      const isGoogleChrome = isChromium && vendor === "Google Inc." && !isEdge && !isOpera && !isBrave;

      if (isGoogleChrome) el.style.display = "none";
    })();

    // Initialize status
    updateStatus('status-inactive', 'Ready');
  </script>
</body>
</html>